import java.lang.reflect.Array;
import java.util.ArrayList;
import java.util.Random;

public class GameLogic {
	protected final int CORRECTLENGTH = 4;
	private String numToGuess;
	private int numOfGuessing;
	private ArrayList<String>  historyOfGuessing;
	
	public GameLogic() {
		this.numToGuess = createNumber();
		this.numOfGuessing = 0;
		this.historyOfGuessing = new ArrayList<String>();
	}
	
	public String getNum() 
	{												
		return numToGuess;
	}
	
	public int getNumOfGuessing() 
	{												
		return numOfGuessing;
	}
	
	public ArrayList<String> getHistoryOfGuessing() 
	{												
		return historyOfGuessing;
	}
	
	
	public String checkGuess(String guess)
	{
		String message = "";
		int bulls = 0;
		int hits = 0;
		int i;
		String elementToHistory = "";
		int duplicateFlag = 0;
		
		if(validGuess(guess).length() > 0 ){
			message = validGuess(guess); 
		}
		else 
		{
			if(this.getHistoryOfGuessing().size()>0)
			{
				for(i = 0; i < this.getHistoryOfGuessing().size(); i++)
				{
					if (this.getHistoryOfGuessing().get(i).substring(0,4).equals(guess))
					{
						message = "You guessed wrong already with this sequence: " + guess + " please try different sequence";
						duplicateFlag = 1;
					}
				}
			}
			if(duplicateFlag == 0)
			{
				this.numOfGuessing++;
				if(this.numToGuess.contentEquals(guess))
				{
					message= "Very well, you Won! the sequence of digits is : "+ this.getNum() + ", it's took you " 
								+ this.getNumOfGuessing() + " times.";
				}
				else
				{
					for (i=0; i<CORRECTLENGTH; i++)
					{
						if(this.getNum().charAt(i) == guess.charAt(i)){
							bulls +=1;
						}
						else if(this.getNum().contains("" +guess.charAt(i))){
							hits += 1;
						}
					}
					
					message = "Your history of guesses : " + this.getHistoryOfGuessing() 
					+"\nYour guess is "+ guess +" , has "+ bulls +" Bulls and "
							+ hits +" hits";
					
					elementToHistory = elementToHistory + guess + " bulls: " + bulls + " hits: " + hits + "\n";
					this.historyOfGuessing.add(elementToHistory);
				}
			}
		}
		
		return message;
	}
	
	
	public String validGuess(String guess)
	{
		String message = "";
		int i , j;
		char c;
		int flagError = 0;
		
		if(guess.length() != CORRECTLENGTH)
		{
			message = "Not valid guess! , your guess must to be 4 digit";
			flagError = 1;
		}
		else if(flagError == 0)
		{
			for( i = 0; i < CORRECTLENGTH;i++)
			{
				c = guess.charAt(i);
				if( (c >= 'A' && c <= 'Z') || (c >= 'a' && c<= 'z') )
				{
					message = "Not valid guess! , your guess must have only numeric characters.";
					flagError = 1;
					break;
				}	
				
				for( j = i+1;j < CORRECTLENGTH;j++)
				{
					if(c == guess.charAt(j))
					{
						message = "Not valid guess! , your guess can not have repeat digit.";
						flagError = 1;
						break;
					}
				}
				if(flagError == 1)
				{
					break;
				}

			}
		}

		return message;
		
	}
	
	private String createNumber()
	{
		Random r = new Random();
		String number = "";
		int digit;
		while(number.length() < CORRECTLENGTH)
		{
			digit = r.nextInt(10);
			if(!(number.contains(""+digit)))
				number += digit;
		}
		System.out.println("number : "+number);//need to delete!!!
		return number;
	}
	
	public void reset()
	{
		this.numToGuess = createNumber();
		this.numOfGuessing = 0;
		this.historyOfGuessing.clear();
	}
	

}
