import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;
import java.util.Random;

import javafx.event.ActionEvent;
import javafx.fxml.FXML;
import javafx.scene.control.ComboBox;
import javafx.scene.control.Label;
import javafx.scene.shape.Circle;
import javafx.scene.shape.Line;

public class HangmanController {

	final int LETTERS  = 26;

    @FXML
    private Label guesses;

    @FXML
    private ComboBox<Character> letters;

    @FXML
    private Label rightLetters;
    
    @FXML
    private Label feedback;

    @FXML
    private Circle head;

    @FXML
    private Line leftArm;

    @FXML
    private Line leftLeg;
    
    @FXML
    private Line chest;
    
    @FXML
    private Line rightArm;

    @FXML
    private Line rightLeg;
	
	private Game game;

	@FXML
	public void initialize() {

		stateOfAllBodyShapes(false);

		game = new Game();
		
		game.setRandomWord(createSecretWord());
		

		for(int j = 0; j < game.getRandomWord().length();j++)
    	{
    		game.setRevealWord(game.getRevealWord() + '_');
    	}
		rightLetters.setText(game.getRevealWord());
		
		initCombobox();
	}

    @FXML
    void guessPressed(ActionEvent event) {
    	
    	if(letters.getSelectionModel().isEmpty() == true)
    	{
			feedback.setText("You must choose letter!");
    	}
    	else
    	{
    		if(game.getNumOfGuesses() > 5)
        	{
    			feedback.setText("You lost!" + "\nThe right word is : " + game.getRandomWord());
        	}
        	else
        	{
        		if( !(game.getRevealWord().equals(game.getRandomWord())))
        		{
        			drawLetterInWord(letters.getValue());

        			rightLetters.setText(game.getRevealWord());

        			if(game.getRevealWord().equals(game.getRandomWord()))
            		{
            			feedback.setText("You Won!");
            		}

                	game.getGuesseArray().add(letters.getValue());
                	String stringOfGuesses = "";

                	for(int i = 0 ; i < game.getGuesseArray().size() ;i++)
                	{
                		stringOfGuesses += " " +   game.getGuesseArray().get(i);
                	}
                		
            		guesses.setText(stringOfGuesses);
            		
        			switch(game.getNumOfGuesses())
        			{
        				case 1:head.setVisible(true);
        					   break;
        				case 2:chest.setVisible(true);
    						   break;
        				case 3:rightArm.setVisible(true);
    						   break;
        				case 4:leftArm.setVisible(true);
    						   break;
        				case 5:rightLeg.setVisible(true);
    						   break;
        				case 6:leftLeg.setVisible(true);
            					feedback.setText("You lost!" + "\nThe right word is : " + game.getRandomWord());
            					break;
        			}

            		updateCombobox(letters.getValue());
        		}
        	}
    	}
    }
    
    private void drawLetterInWord(char letter)
	{
		int foundLetterFlag = 0; // 0 = not found a signal letter  , 1 = found one letter

		for(int i = 0; i < game.getRandomWord().length();i++)
    	{
    		if(game.getRandomWord().charAt(i) == letter)
    		{
    			foundLetterFlag = 1;
    			game.setRevealWord( game.getRevealWord().substring(0,i) + letter + game.getRevealWord().substring(i+1,game.getRandomWord().length()) );
    		}
    	}
    	if ( foundLetterFlag == 0)
    	{
    		game.setNumOfGuesses(game.getNumOfGuesses() + 1);
    	}
	} 
    
	private void updateCombobox(char letter)
	{
    	for(int i = 0; i< letters.getItems().size();i++)
    	{
    		if( letter == letters.getItems().get(i) )
    			letters.getItems().remove(i);
    	}
	}
    
    @FXML
    void resetPressed(ActionEvent event) {
    	game.setNumOfGuesses(0);

		String randomWord = createSecretWord();
    	game.setRandomWord(randomWord);
 	    
	    game.setRevealWord("");
		for(int j = 0; j < game.getRandomWord().length();j++)
    	{
    		game.setRevealWord(game.getRevealWord() + '_');
    	}
    	
		rightLetters.setText(game.getRevealWord());
    	guesses.setText("");
    	feedback.setText("");
    	
		stateOfAllBodyShapes(false);
    	
    	game.getGuesseArray().clear();
    	initCombobox();
    }

    private void stateOfAllBodyShapes(Boolean visible)
    {
		head.setVisible(visible);
		chest.setVisible(visible);
		leftArm.setVisible(visible);
		rightArm.setVisible(visible);
		leftLeg.setVisible(visible);
		rightLeg.setVisible(visible);
    }
	
	private void initCombobox() 
	{
		letters.getItems().clear();
    	char letter = 'a';
    	for(int i = 0; i< LETTERS;i++)
    	{
    		letters.getItems().add(letter);
    		letter += 1;
    	}
    	letters.setValue('a');
	}
	
    private String createSecretWord()
    {
		Random rand = new Random();
    	List<String> words = new ArrayList<String>();
		String[] wordsLine;
		String secretWord = new String();

		try
		{
			FileReader fr = new FileReader("words.txt");
			BufferedReader reader = new BufferedReader(fr);
			String line = reader.readLine();
			while(line != null) 
			{
		        wordsLine = line.split(" ");
		        for(String word : wordsLine) {
		            words.add(word);
		        }
		        line = reader.readLine();
			}
			fr.close();
		}
		catch(IOException e)
		{
			System.out.println("Error");
		}

		secretWord = words.get(rand.nextInt(words.size()));
		return secretWord;
    }
}
